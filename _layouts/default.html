<!DOCTYPE html>
<html lang="en">

{% include head.html %}

<body class="{% if site.data.settings.color_scheme == "auto" %}scheme--toggle{% else %}scheme--{{ site.data.settings.color_scheme }}{% endif %}">

  <!-- Google Tag Manager -->
<!--  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':-->
<!--      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],-->
<!--    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=-->
<!--    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);-->
<!--  })(window,document,'script','dataLayer','GTM-TKGX8P2');</script>-->
  <!-- End Google Tag Manager -->

  <!-- Consent Banner (Modal) -->
<div id="consent-banner">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <div class="consent-modal">
    <h2>Privacy & Cookie Consent</h2>
    <p>We value your privacy and want to be transparent about the data we collect, how we use it, and your rights to control that information. Consent for cookies and data collection helps us personalize and improve your experience. Please choose your preferences below.</p>
    <div class="consent-buttons">
      <button id="preferences-btn">Preferences</button>
      <button id="grant-consent">Grant Consent</button>
      <button id="deny-consent">Deny Consent</button>
    </div>

      <!-- Preferences Section -->
      <div class="consent-preferences" id="consent-preferences">
        <label for="ad_storage">
          <input type="checkbox" id="ad_storage">
          <strong>Enable Targeted Ads</strong>
          <br>
          <span class="consent-description">Allow us to store information for the purpose of delivering tailored advertising based on your interests and interactions.</span>
        </label>

        <label for="analytics_storage">
          <input type="checkbox" id="analytics_storage">
          <strong>Allow Website Analytics</strong>
          <br>
          <span class="consent-description">Consent to the storage of data for analyzing how you navigate and interact with our site, helping us improve your user experience.</span>
        </label>

        <label for="ad_user_data">
          <input type="checkbox" id="ad_user_data">
          <strong>Personalize Ad Profiles</strong>
          <br>
          <span class="consent-description">Agree to the collection of demographic and behavioral data to create personalized advertising profiles.</span>
        </label>

        <label for="ad_personalization">
          <input type="checkbox" id="ad_personalization">
          <strong>Customize Ad Experience</strong>
          <br>
          <span class="consent-description">Allow us to use your data to make the advertisements you see more relevant to your interests.</span>
        </label>

        <label for="functionality_storage">
          <input type="checkbox" id="functionality_storage">
          <strong>Remember Site Preferences</strong>
          <br>
          <span class="consent-description">Permit us to remember your settings and preferences (like language and layout) for a more personalized website experience.</span>
        </label>

        <label for="personalization_storage">
          <input type="checkbox" id="personalization_storage">
          <strong>Personalize Content</strong>
          <br>
          <span class="consent-description">Consent to the use of your data for personalizing your content experience beyond advertisements.</span>
        </label>

        <label for="security_storage">
          <input type="checkbox" id="security_storage">
          <strong>Enhance Security</strong>
          <br>
          <span class="consent-description">Enable us to store data critical for security purposes, such as authentication and fraud prevention.</span>
        </label>
        <button id="save-preferences">Save Preferences</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var consentBanner = document.getElementById('consent-banner');
      var grantButton = document.getElementById('grant-consent');
      var denyButton = document.getElementById('deny-consent');

      grantButton.addEventListener('click', function() {
        localStorage.setItem('consentGranted', 'true');
        updateConsent(true);
        consentBanner.style.display = 'none';
      });

      denyButton.addEventListener('click', function() {
        localStorage.setItem('consentGranted', 'false');
        updateConsent(false);
        consentBanner.style.display = 'none';
      });

      function updateConsent(consent) {
        var consentConfig = {
          'ad_storage': consent ? 'granted' : 'denied',
          'analytics_storage': consent ? 'granted' : 'denied',
          'ad_user_data': consent ? 'granted' : 'denied',
          'ad_personalization': consent ? 'granted' : 'denied',
          'functionality_storage': consent ? 'granted' : 'denied',
          'personalization_storage': consent ? 'granted' : 'denied',
          'security_storage': consent ? 'granted' : 'denied',
        };
        gtag('consent', 'update', consentConfig);
        localStorage.setItem('individualConsentPreferences', JSON.stringify(consentConfig));
        if (consent) loadTagManager();
      }

      function loadTagManager() {
        var gtmScript = document.createElement('script');
        gtmScript.async = true;
        gtmScript.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-TKGX8P2'; // Replace YOUR_CONTAINER_ID
        document.head.appendChild(gtmScript);
      }

      if(localStorage.getItem('consentGranted') === 'true') {
        updateConsent(true);
        consentBanner.style.display = 'none';
      }

      // Existing consent banner code goes here

      // Function to save individual consent preferences
      function saveIndividualConsentPreferences() {
        var consentConfig = {
          'ad_storage': document.getElementById('ad_storage').checked ? 'granted' : 'denied',
          'analytics_storage': document.getElementById('analytics_storage').checked ? 'granted' : 'denied',
          'ad_user_data': document.getElementById('ad_user_data').checked ? 'granted' : 'denied',
          'ad_personalization': document.getElementById('ad_personalization').checked ? 'granted' : 'denied',
          'functionality_storage': document.getElementById('functionality_storage').checked ? 'granted' : 'denied',
          'personalization_storage': document.getElementById('personalization_storage').checked ? 'granted' : 'denied',
          'security_storage': document.getElementById('security_storage').checked ? 'granted' : 'denied',
          // Add other preferences
        };
        gtag('consent', 'update', consentConfig);
        localStorage.setItem('individualConsentPreferences', JSON.stringify(consentConfig));
      }

      // Function to load individual consent preferences
      function loadIndividualConsentPreferences() {
        var savedPreferences = localStorage.getItem('individualConsentPreferences');
        if (savedPreferences) {
          var preferences = JSON.parse(savedPreferences);
          for (var key in preferences) {
            if (preferences.hasOwnProperty(key)) {
              document.getElementById(key).checked = preferences[key] === 'granted';
            }
          }
        }
      }

      // "Save Preferences" button functionality
      var savePreferencesBtn = document.getElementById('save-preferences');
      savePreferencesBtn.addEventListener('click', function() {
        saveIndividualConsentPreferences();
        if (isAnyCheckboxChecked) loadTagManager();
        consentBanner.style.display = 'none';
        document.getElementById('consent-preferences').style.display = 'none';
      });

      // Load individual preferences when the modal is opened
      var preferencesBtn = document.getElementById('preferences-btn');
      preferencesBtn.addEventListener('click', function() {
        loadIndividualConsentPreferences();
        document.getElementById('consent-preferences').style.display = 'block';
      });

      // Link to reopen the consent modal
      var reopenConsentModalLink = document.getElementById('reopen-consent-modal');
      reopenConsentModalLink.addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('consent-banner').style.display = 'block';
      });

      function isAnyCheckboxChecked() {
        var preferencesDiv = document.getElementById('consent-preferences');
        var checkboxes = preferencesDiv.querySelectorAll('input[type="checkbox"]');
        return Array.from(checkboxes).some(checkbox => checkbox.checked);
      }


    });
  </script>

  <!-- Rest of your HTML content -->


  {% if site.data.settings.google_analytics %}
    {% include google-analytics.html %}
  {% endif %}

  <!-- begin global wrap -->
  <div class="global-wrap">
    {% include header.html %}
  
    <!-- begin content -->
    <main class="content" aria-label="Content">
      {{ content }}
    </main>
    <!-- end content -->
  
    {% include footer.html %}
    <a href="#" id="reopen-consent-modal">Marketing Preferences</a>
  </div>
  <!-- end global wrap -->

  <script src="{{ site.baseurl }}/js/scripts.js"></script>
  <script src="{{ site.baseurl }}/js/common.js"></script>
</body>

</html>