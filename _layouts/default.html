<!DOCTYPE html>
<html lang="en">

{% include head.html %}

<body class="{% if site.data.settings.color_scheme == "auto" %}scheme--toggle{% else %}scheme--{{ site.data.settings.color_scheme }}{% endif %}">

  <!-- Google Tag Manager -->
<!--  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':-->
<!--      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],-->
<!--    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=-->
<!--    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);-->
<!--  })(window,document,'script','dataLayer','GTM-TKGX8P2');</script>-->
  <!-- End Google Tag Manager -->

  <!-- Consent Banner (Modal) -->
  <div id="consent-banner">
    <div class="consent-modal">
      <p>Please provide your consent for cookies and data collection. We use cookies to personalize content and ads, to provide social media features, and to analyze our traffic.</p>
      <div class="consent-buttons">
        <button id="grant-consent">Grant Consent</button>
        <button id="deny-consent">Deny Consent</button>
        <button id="preferences-btn">Preferences</button>
      </div>

      <!-- Preferences Section -->
      <div class="consent-preferences" id="consent-preferences">
        <label><input type="checkbox" id="ad_storage"> Ad Storage</label>
        <label><input type="checkbox" id="analytics_storage"> Analytics Storage</label>
        <label><input type="checkbox" id="functionality_storage"> Functionality Storage</label>
        <label><input type="checkbox" id="personalization_storage"> Personalization Storage</label>
        <label><input type="checkbox" id="security_storage"> Security Storage</label>
        <button id="save-preferences">Save Preferences</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var consentBanner = document.getElementById('consent-banner');
      var grantButton = document.getElementById('grant-consent');
      var denyButton = document.getElementById('deny-consent');
      var preferencesBtn = document.getElementById('preferences-btn');
      var preferencesSection = document.getElementById('consent-preferences');
      var savePreferencesBtn = document.getElementById('save-preferences');

      function loadConsentPreferences() {
        var preferences = localStorage.getItem('consentPreferences');
        if (preferences) {
          preferences = JSON.parse(preferences);
          for (var key in preferences) {
            if (preferences.hasOwnProperty(key)) {
              document.getElementById(key).checked = preferences[key] === 'granted';
            }
          }
        }
      }

      function saveConsentPreferences(preferences) {
        localStorage.setItem('consentPreferences', JSON.stringify(preferences));
      }

      function applyConsentUpdate(consent) {
        var consentConfig = {
          'ad_storage': consent,
          'analytics_storage': consent,
          'ad_user_data': consent,
          'ad_personalization': consent,
          'functionality_storage': consent,
          'personalization_storage': consent,
          'security_storage': consent
        };
        gtag('consent', 'update', consentConfig);
        saveConsentPreferences(consentConfig);
        if (consent === 'granted') loadTagManager();
      }

      grantButton.addEventListener('click', function() {
        localStorage.setItem('consentGranted', 'true');
        applyConsentUpdate('granted');
        consentBanner.style.display = 'none';
      });

      denyButton.addEventListener('click', function() {
        localStorage.setItem('consentGranted', 'false');
        applyConsentUpdate('denied');
        consentBanner.style.display = 'none';
      });

      preferencesBtn.addEventListener('click', function() {
        preferencesSection.style.display = preferencesSection.style.display === 'none' ? 'block' : 'none';
      });

      savePreferencesBtn.addEventListener('click', function() {
        var consentConfig = {
          'ad_storage': document.getElementById('ad_storage').checked ? 'granted' : 'denied',
          'analytics_storage': document.getElementById('analytics_storage').checked ? 'granted' : 'denied',
          'functionality_storage': document.getElementById('functionality_storage').checked ? 'granted' : 'denied',
          'personalization_storage': document.getElementById('personalization_storage').checked ? 'granted' : 'denied',
          'security_storage': document.getElementById('security_storage').checked ? 'granted' : 'denied'
        };
        gtag('consent', 'update', consentConfig);
        saveConsentPreferences(consentConfig);
        preferencesSection.style.display = 'none';
      });

      function loadTagManager() {
        var gtmScript = document.createElement('script');
        gtmScript.async = true;
        gtmScript.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-TKGX8P2'; // Replace YOUR_CONTAINER_ID
        document.head.appendChild(gtmScript);
      }

      if(localStorage.getItem('consentGranted') === 'true') {
        applyConsentUpdate('granted');
        consentBanner.style.display = 'none';
      } else if (localStorage.getItem('consentGranted') === 'false') {
        applyConsentUpdate('denied');
        consentBanner.style.display = 'none';
      }

      // Load saved consent preferences if available
      loadConsentPreferences();
    });
  </script>

  <!-- Rest of your HTML content -->


  {% if site.data.settings.google_analytics %}
    {% include google-analytics.html %}
  {% endif %}

  <!-- begin global wrap -->
  <div class="global-wrap">
    {% include header.html %}
  
    <!-- begin content -->
    <main class="content" aria-label="Content">
      {{ content }}
    </main>
    <!-- end content -->
  
    {% include footer.html %}
  </div>
  <!-- end global wrap -->

  <script src="{{ site.baseurl }}/js/scripts.js"></script>
  <script src="{{ site.baseurl }}/js/common.js"></script>
</body>

</html>